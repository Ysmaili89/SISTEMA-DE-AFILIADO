{% extends 'base.html' %} 

{% block title %}Inicio - Afiliados Online{% endblock %}

{% block meta_description %}
Descubre productos recomendados, guías de compra, comparativas y ofertas seleccionadas por expertos en Afiliados Online.
{% endblock %}

{% block meta_keywords %}
productos destacados, ofertas online, comparativas, reseñas, recomendaciones, guías de compra
{% endblock %}

{% block content %}
<header class="mb-5 text-center">
    <h1 class="display-4 fw-bold">Productos Destacados</h1>
    <p class="lead text-muted">Seleccionamos las mejores ofertas y productos populares para ayudarte a comprar con confianza. </p>
</header>

<section class="row">
    {% for p in productos %}
    <article class="col-12 col-md-6 col-lg-4 mb-4 d-flex align-items-stretch">
        <div class="card shadow-sm border border-light-subtle rounded-4 w-100 h-100 transition-all" style="transition: box-shadow 0.3s ease;">
            <a href="{{ url_for('publico.product_detail', slug=p.slug) }}" aria-label="Ver más sobre {{ p.nombre }}">
                <div class="position-relative" style="aspect-ratio: 3/2; overflow: hidden;">
                    <img src="{{ p.imagen }}"
                         class="card-img-top img-fluid position-absolute top-0 start-0 w-100 h-100"
                         alt="{{ p.nombre }}"
                         style="object-fit: cover;"
                         loading="lazy">
                </div>
            </a>
            <div class="card-body d-flex flex-column p-3">
                <a href="{{ url_for('publico.product_detail', slug=p.slug) }}"
                   class="text-decoration-none text-dark"
                   aria-label="Ver más sobre {{ p.nombre }}">
                    <h2 class="card-title h6 mb-2" style="min-height: 3.5rem;">{{ p.nombre }}</h2>
                </a>

                <div class="mt-auto d-flex gap-2">
                    <a href="{{ url_for('publico.product_detail', slug=p.slug) }}"
                       class="btn btn-secondary btn-sm w-100 px-2 py-1"
                       style="font-size: 0.75rem;"
                       aria-label="Ver {{ p.nombre }}">
                        <i class="fas fa-eye me-1"></i> Ver
                    </a>
                    <a href="{{ p.link }}"
                       class="btn btn-primary btn-sm w-100 px-2 py-1"
                       style="font-size: 0.75rem;"
                       target="_blank" rel="sponsored noopener nofollow"
                       aria-label="Comprar {{ p.nombre }} ahora">
                        <i class="fas fa-shopping-cart me-1"></i> Comprar
                    </a>
                </div>
            </div>
        </div>
    </article>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info text-center" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i> No hay productos disponibles en este momento. Vuelve pronto para más recomendaciones.
        </div>
    </div>
    {% endfor %}
</section>

{% set destacados_anuncios = active_advertisements | selectattr('type', 'in', ['destacado', 'mas_vendido']) | list %}
{% if destacados_anuncios %}
<section class="my-5">
    <h2 class="text-center mb-4 display-6 fw-bold">Anuncios Destacados</h2>
    <div class="row">
        {% for ad in destacados_anuncios %}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm border-0 rounded-3 text-center p-4">
                <div class="card-body">
                    <h5 class="card-title">{{ ad.title }}</h5>
                    <p class="card-text">{{ ad.text_content }}</p>
                    <a href="{{ ad.button_url }}" class="btn btn-primary mt-3" target="_blank" rel="noopener noreferrer">{{ ad.button_text }}</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% set recomendado_anuncios = active_advertisements | selectattr('type', 'equalto', 'recomendado') | list %}
{% if recomendado_anuncios %}
<section class="my-5">
    <h2 class="text-center mb-4 display-6 fw-bold">Productos Recomendados</h2>
    <div class="row">
        {% for ad in recomendado_anuncios %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                {% if ad.image_url %}
                <img src="{{ ad.image_url }}" class="card-img-top" alt="{{ ad.title }}" loading="lazy">
                {% endif %}
                <div class="card-body text-center">
                    <h5 class="card-title">{{ ad.title }}</h5>
                    {% if ad.product %}
                    <p class="card-text">{{ ad.product.nombre }}</p>
                    <a href="{{ url_for('publico.product_detail', slug=ad.product.slug) }}" class="btn btn-primary mt-2">Ver Producto</a>
                    {% else %}
                    <p class="card-text">Producto no especificado.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

{% set adsense_anuncios = active_advertisements | selectattr('type', 'in', ['patrocinado', 'relevante']) | list %}
{% if adsense_anuncios %}
<section class="my-5 text-center">
    <h2 class="mb-4 display-6 fw-bold">Anuncios Patrocinados</h2>
    {% for ad in adsense_anuncios %}
        <div class="my-4">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="{{ ad.adsense_client_id }}"
                 data-ad-slot="{{ ad.adsense_slot_id }}"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    {% endfor %}
</section>
{% endif %}

<section class="my-5 text-center py-5 bg-light rounded-3 shadow-sm">
    <p class="mb-4 lead px-md-5">Nuestro equipo analiza, compara y selecciona productos de forma imparcial para que tomes decisiones informadas con confianza.</p>
    <a href="{{ url_for('publico.acerca_de') }}" class="btn btn-info btn-lg px-4" role="button">
        <i class="fas fa-users me-2"></i> Conoce más sobre nosotros
    </a>
</section>

{% if testimonios %}
<section class="my-5 py-5">
    <h2 class="text-center mb-4 display-6 fw-bold">Lo que dicen nuestros usuarios</h2>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for t in testimonios %}
        <div class="col d-flex">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                <div class="card-body d-flex flex-column">
                    <div class="text-warning mb-2">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                    </div>
                    <p class="card-text flex-grow-1">{{ t.content }}</p>
                    <footer class="blockquote-footer mt-3">
                        <cite title="Testimonio de usuario">{{ t.author }}</cite>
                    </footer>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}